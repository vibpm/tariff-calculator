<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор тарифов</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <div class="calculator-card">
            <header class="card-header">
                <h1>Калькулятор тарифов</h1>
                <p>Выберите параметры для расчета стоимости</p>
            </header>

            <main class="card-body">
                
                <div class="form-group">
                    <label for="period">Месяц прейскуранта</label>
                    <select id="period">
                        {% for p in periods %}
                        <option value="{{ p }}">{{ p }}</option>
                        {% endfor %}
                    </select>
                    <div id="period-warning" class="validation-message"></div>
                </div>
                
                <div class="form-group">
                    <label for="service">Тарифный план</label>
                    <select id="service">
                        <option value="">Выберите или начните вводить название...</option>
                        {% for s in services %}
                        <option value="{{ s }}">{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="levels-container">
                    <div class="levels-header">
                        <div>Уровень</div>
                        <div>Пользователи</div>
                        <div>Минуты</div>
                    </div>
                    <div id="levels-body">
                        <div class="level-placeholder">Сначала выберите тарифный план</div>
                    </div>
                    <div class="levels-footer">
                        <div>Всего:</div>
                        <div id="total-accounts">0</div>
                        <div id="total-minutes">0</div>
                    </div>
                </div>
                
                <div id="levels-warning" class="validation-message"></div>

                <div class="options-container">
                    <div class="form-group">
                        <label for="promotion">Акция</label>
                        <select id="promotion" disabled>
                            <option value="no_promotion">Нет акции</option>
                        </select>
                    </div>

                    <!-- ===== ИЗМЕНЕНИЕ ЗДЕСЬ: Добавлен блок для Условия 2 ===== -->
                    <div class="form-group">
                        <label for="promotion_condition2">Дополнительное условие</label>
                        <input type="text" id="promotion_condition2" value="-" readonly>
                    </div>
                    <!-- ======================================================== -->

                    <div class="form-group">
                        <label for="promotion_discount">Скидка по акции, %</label>
                        <input type="text" id="promotion_discount" value="-" readonly>
                    </div>
                    <div class="form-group">
                        <label for="prepayment_months">Период предоплаты, мес</label>
                        <input type="number" id="prepayment_months" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label for="discount_percent">Скидка, %</label>
                        <input type="number" id="discount_percent" value="0" min="0" max="100" step="0.1">
                    </div>

                    <div class="options-group">
                         <div class="form-group">
                            <label for="fixation_months">Период фиксации, мес</label>
                            <input type="number" id="fixation_months" value="0" min="0" max="12">
                        </div>
                        <div class="form-group">
                            <label for="fixation_coefficient">Коэффициент фиксации</label>
                            <input type="text" id="fixation_coefficient" value="1.0" readonly>
                        </div>
                    </div>
                </div>
                <button id="calculate-btn" class="btn-primary">Рассчитать</button>
            </main>

            <footer id="result-container" class="card-footer">
                <!-- Основной результат появится здесь -->
            </footer>

            <div class="card-actions" id="result-actions-container" hidden>
                <button id="download-btn" class="btn-primary">Скачать коммерческое предложение</button>
            </div>

            <details id="calculation-details-container" class="card-details" hidden>
                <summary>Показать пошаговый расчет</summary>
                <div id="calculation-steps">
                    <!-- Шаги расчета появятся здесь -->
                </div>
            </details>

        </div>
    </div>

    <script>
        const MINUTE_MAP = {{ minutes_map_json | safe }};
        const FIXATION_COEFFICIENT_MAP = {{ fixation_map_json | safe }};
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="/static/js/script.js"></script>
</body>
</html>